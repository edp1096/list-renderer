{
  "version": 3,
  "sources": ["../ts/list-renderer.ts"],
  "sourcesContent": ["interface LoopDataType { [key: string]: LoopDataType }\r\n\r\nclass ListRenderer {\r\n    root: HTMLElement\r\n    template: string\r\n    regexForVariables: RegExp\r\n    loopDatas: LoopDataType\r\n    baseTemplate: string\r\n    singleTags: string[]\r\n\r\n    constructor(root: HTMLElement) {\r\n        this.root = root\r\n        this.template = \"\"\r\n        this.regexForVariables = /{{(.*?)}}/g\r\n        this.loopDatas = {}\r\n\r\n        this.baseTemplate = \"\"\r\n        this.singleTags = [\"input\", \"img\", \"br\", \"hr\", \"link\", \"meta\", \"base\", \"area\", \"col\", \"embed\", \"keygen\", \"param\", \"source\", \"track\", \"wbr\", \"command\"]\r\n    }\r\n\r\n    evaluateString(cmd: string): any { return new Function(\"'use strict'; return (\" + cmd + \")\")() }\r\n\r\n    parseTemplate(el: Element, dataName: string, loopName: string, idx: string): Element | null {\r\n        if (typeof el != \"object\") { return null }\r\n\r\n        const data = this.loopDatas[loopName][idx]\r\n\r\n        let result = \"\"\r\n        let condIF = el.getAttribute(\"lr-if\")\r\n        if (condIF != null) {\r\n            let isShow = true\r\n\r\n            condIF = condIF.replace(\"$index\", idx)\r\n\r\n            for (const [k, v] of Object.entries(data)) {\r\n                const tmpCondIF = condIF.replace(k, `\"${v}\"`)\r\n                try { isShow = this.evaluateString(tmpCondIF) } catch (e) { continue }\r\n                break\r\n            }\r\n\r\n            el.removeAttribute(\"lr-if\")\r\n\r\n            if ((isShow != null) && (!isShow)) {\r\n                el.innerHTML = \"\"\r\n                return el\r\n            }\r\n        }\r\n\r\n        let condCLK = el.getAttribute(\"lr-click\")\r\n        if (condCLK != undefined) {\r\n            condCLK = condCLK.replace(\"$index\", idx)\r\n\r\n            el.setAttribute(\"onclick\", condCLK)\r\n            el.removeAttribute(\"lr-click\")\r\n        }\r\n\r\n        let condCHG = el.getAttribute(\"lr-change\")\r\n        if (condCHG != undefined) {\r\n            condCHG = condCHG.replace(\"$index\", idx)\r\n\r\n            el.setAttribute(\"onchange\", condCHG)\r\n            el.removeAttribute(\"lr-change\")\r\n        }\r\n\r\n        let condCHK = el.getAttribute(\"lr-checked\")\r\n        if (condCHK != undefined) {\r\n            condCHK = condCHK.replace(\"$index\", idx)\r\n\r\n            el.setAttribute(\"onchange\", condCHK)\r\n            el.removeAttribute(\"lr-change\")\r\n        }\r\n\r\n        let dirID = el.getAttribute(\"lr-id\")\r\n        if (dirID != undefined) {\r\n            dirID = dirID.replace(\"$index\", idx)\r\n            el.setAttribute(\"data-id\", dirID)\r\n            el.removeAttribute(\"lr-id\")\r\n        }\r\n\r\n        if (el.children != undefined && el.children.length > 0) {\r\n            for (let i in el.children) {\r\n                const child = this.parseTemplate(el.children[i], dataName, loopName, idx)\r\n                if (child) {\r\n                    switch (true) {\r\n                        case this.singleTags.includes(child.tagName.toLowerCase()):\r\n                            result += child.outerHTML\r\n                            break\r\n                        case (child.innerHTML.trim() != \"\"):\r\n                            result += child.outerHTML\r\n                            break\r\n                        default:\r\n                            break\r\n                    }\r\n                }\r\n            }\r\n\r\n            el.innerHTML = \"\"\r\n        } else {\r\n            if (el.innerHTML != \"\" || this.singleTags.includes(el.tagName.toLowerCase())) {\r\n                const attrs = el.getAttributeNames()\r\n                for (let i in attrs) {\r\n                    let attrValue = el.getAttribute(attrs[i])\r\n                    if (attrValue == null) { continue }\r\n                    attrValue = attrValue.replace(\"$index\", idx)\r\n                    attrValue = attrValue.replace(this.regexForVariables, (_: string, val: string) => {\r\n                        let value = this.evaluateString(`${dataName}[\"${val}\"]`)\r\n                        if (value == undefined) { value = \"\" }\r\n                        return value\r\n                    })\r\n\r\n                    el.setAttribute(attrs[i], attrValue.replace(\"$index\", idx))\r\n                }\r\n\r\n                if (!this.singleTags.includes(el.tagName.toLowerCase())) {\r\n                    el.innerHTML = el.innerHTML.replace(this.regexForVariables, (_: string, cmd: string) => {\r\n                        let value = this.evaluateString(`${dataName}[\"${cmd}\"]`)\r\n                        if (value == undefined) { value = \"\" }\r\n                        return value\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        if (result.length > 0) {\r\n            el.innerHTML = result\r\n        }\r\n\r\n        return el\r\n    }\r\n\r\n\r\n\r\n    renderLoop(el: Element): void {\r\n        if ((el.nodeType != undefined) && (el.tagName.toLowerCase() != \"script\")) {\r\n            const loopName: string | null = el.getAttribute(\"lr-loop\")\r\n            if (loopName == undefined || loopName == null) { return }\r\n\r\n            const loopData: LoopDataType = this.evaluateString(loopName)\r\n            this.loopDatas[loopName] = loopData\r\n\r\n            this.baseTemplate = el.innerHTML\r\n            let result: string[] = new Array()\r\n\r\n            if (loopName != undefined) {\r\n                for (let j in loopData) {\r\n                    el.innerHTML = this.baseTemplate\r\n\r\n                    const child = this.parseTemplate(el, `${loopName}[${j}]`, loopName, j)\r\n                    if (child == null) { continue }\r\n                    result.push(child.innerHTML)\r\n                }\r\n\r\n                el.innerHTML = result.join(\"\").trim()\r\n                el.removeAttribute(\"lr-loop\")\r\n            }\r\n        }\r\n    }\r\n\r\n    render(): void {\r\n        this.template = this.root.innerHTML\r\n\r\n        switch (this.root.tagName.toLowerCase()) {\r\n            case \"list-renderer\":\r\n                this.renderLoop(this.root)\r\n                this.root.outerHTML = this.root.innerHTML\r\n                break\r\n            default:\r\n                const c = this.root.children\r\n                for (let i in c) { this.renderLoop(c[i]) }\r\n                break\r\n        }\r\n    }\r\n\r\n    restoreToTemplate(): void { this.root.innerHTML = this.template }\r\n\r\n    reload(): void {\r\n        this.restoreToTemplate()\r\n        this.render()\r\n    }\r\n}\r\n\r\n(globalThis as any).ListRenderer = ListRenderer\r\nglobalThis.customElements.define('list-renderer', class extends HTMLElement { })\r\n\r\nexport default ListRenderer\r\n"],
  "mappings": "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",
  "names": []
}
